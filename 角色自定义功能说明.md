# 角色自定义功能说明

## 功能概述

成功实现了在开始试炼前的角色自定义功能，玩家现在可以自定义以下属性：

1. **姓名**：2-4个中文字符
2. **性别**：男/女选择
3. **资质**：五个等级可选
   - 丁等资质 (20-30% 元海)：最高二转
   - 丙等资质 (40-50% 元海)：通常二转，偶三转
   - 乙等资质 (60-70% 元海)：可达三至四转
   - 甲等资质 (80-90% 元海)：可达五转
   - 十绝体 (100% 元海)：可自爆，极度危险

4. **初始修为**：
   - 一转初阶
   - 一转中阶
   - 一转高阶

5. **初始元石**：10-100（可通过滑块调整）

6. **出身背景**：自定义背景故事（80-150字）

## 实现方式

### 前端实现 (GameView.vue)

1. **角色创建对话框**：
   - 使用Element Plus的el-dialog组件
   - 表单包含所有可自定义的属性字段
   - 验证规则确保输入的合法性

2. **交互流程**：
   - 点击"开始试炼"按钮 → 显示角色创建对话框
   - 填写角色信息或选择"随机生成"
   - 确认创建 → 发送自定义属性到后端
   - AI根据自定义属性生成角色和开局剧情

### 后端实现

1. **WebSocket消息处理** (game.go)：
   - 接收包含custom_attributes的消息
   - 提取自定义属性并传递给游戏控制器

2. **游戏控制器** (game_controller.go)：
   - 新增ProcessActionStreamWithAttributes方法
   - 将自定义属性添加到AI提示词中
   - 指导AI使用用户提供的属性创建角色

3. **MOD提示词更新** (start_game.txt)：
   - 添加用户自定义属性处理规则
   - AI优先使用用户定义的属性
   - 其他属性根据背景自动生成

## 使用方法

### 自定义角色

1. 进入游戏，选择"蛊界争锋"
2. 点击"开始第一次试炼"
3. 在弹出的角色创建对话框中：
   - 输入角色姓名（2-4个字）
   - 选择性别
   - 选择资质等级
   - 选择初始修为
   - 调整初始元石数量
   - 编写角色背景故事
4. 点击"确定创建"开始游戏

### 随机生成

如果不想自定义，可以：
1. 在角色创建对话框中点击"随机生成"
2. AI将完全随机创建一个独特的角色

## 技术特点

1. **灵活性**：玩家可以选择完全自定义或让AI随机生成
2. **兼容性**：保持了原有的AI创造性，同时尊重用户的选择
3. **用户体验**：直观的界面，清晰的选项说明
4. **数据传递**：通过WebSocket实时传递自定义属性
5. **AI集成**：智能地将自定义属性融入游戏叙事

## 测试建议

1. **正常流程测试**：
   - 自定义所有属性，检查是否正确应用
   - 部分自定义，验证AI补充的合理性
   - 完全随机，确认原功能未受影响

2. **边界测试**：
   - 姓名长度验证（少于2字或多于4字）
   - 背景故事长度验证
   - 元石数值范围验证

3. **兼容性测试**：
   - 不同资质等级的游戏体验
   - 不同初始修为的开局难度
   - 性别对剧情的影响

## 后续优化建议

1. 增加更多可自定义属性（如初始蛊虫选择）
2. 添加角色模板功能（预设几种典型角色）
3. 支持导入/导出角色配置
4. 增加角色外观自定义（如果有图像系统）
5. 实现角色收藏功能，保存喜欢的角色配置

## 注意事项

- 自定义属性会影响游戏平衡性，建议合理设置
- 十绝体虽然强大但有自爆风险，新手慎选
- 背景故事会影响AI生成的剧情走向
- 初始资源过多可能降低游戏挑战性

---

功能已完成实现并可正常使用。玩家现在可以在每次开始新试炼时，根据自己的喜好创建独特的角色了！
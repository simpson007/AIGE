import{d as Pe,u as ze,r as u,z as X,q as Je,A as Ke,c as o,h as A,n as t,F as Y,B as Z,t as v,l as $e,C as D,D as we,G as Se,H as je,I as Ae,p as y,e as Ue,J as M,o as r}from"./index-mlxIPnk9.js";import{k as qe}from"./marked.esm-z4go5P_g.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Qe={class:"game-container"},Xe={key:0,class:"game-selection"},Ye={class:"game-list"},Ze=["onClick"],De={class:"game-card-footer"},es={class:"version"},ss={class:"author"},ts={key:1,class:"game-play"},as={class:"game-header"},is={class:"header-top"},ns={class:"game-title"},ls={class:"mod-id"},os={class:"pc-actions"},rs={class:"opportunities"},cs=["disabled"],ds={class:"mobile-actions"},us={class:"opportunities mobile-opportunities-inline"},vs=["disabled"],ps={class:"game-content"},fs={class:"status-panel pc-status-panel"},ys={class:"panel-content"},hs={key:0,class:"character-status"},_s={class:"status-key"},gs=["innerHTML"],bs={key:1,class:"no-character"},ms={class:"game-main"},ks=["innerHTML"],$s={class:"pc-input-area"},ws=["disabled"],Ss={key:1,class:"action-input-row"},js=["disabled"],As=["disabled"],Cs={key:2,class:"success-message"},Os={class:"mobile-input-area"},Ms={class:"input-area"},xs=["disabled"],Ts={key:1,class:"action-input-row"},Gs=["disabled"],Vs=["disabled"],Ns={key:2,class:"success-message"},Ws={class:"status-panel-content"},Rs={key:0,class:"character-status"},Bs={class:"status-key"},Es=["innerHTML"],Is={key:1,class:"no-character"},Ls={key:2,class:"roll-overlay"},Hs={class:"roll-panel"},Ps={class:"roll-details"},zs={class:"roll-type"},Js={key:0,class:"roll-target"},Ks={key:0,class:"roll-result-display"},Us={class:"roll-value"},qs={key:3,class:"loading-overlay"},Fs={class:"loading-spinner"},Qs={class:"loading-text"},Xs=Pe({__name:"GameView",setup(Ys){const te=Ue(),k=ze(),ee=u([]),h=u(""),ae=u(null),n=u(null),Ce=X(()=>{var e;return((e=n.value)==null?void 0:e.display_history)||[]}),f=X(()=>{var e;return((e=n.value)==null?void 0:e.state)||n.value||{}}),H=X(()=>{var a;const e=(a=f.value)==null?void 0:a.current_life;if(!e||typeof e!="object")return null;const s={};for(const[i,l]of Object.entries(e))if(l!=null&&l!==""&&l!==0){if(Array.isArray(l)&&l.length===0||typeof l=="object"&&!Array.isArray(l)&&Object.keys(l).length===0)continue;s[i]=l}return Object.keys(s).length>0?s:null}),$=u(""),x=u(!1),P=u(!1),S=X(()=>{var e;return((e=f.value)==null?void 0:e.is_processing)||!1}),g=u(!1),T=u("åŠ è½½ä¸­..."),se=u(!1),_=u(null),b=u(!1),G=u(!1);let d=null;const w=u(!1),V=u(!0),z=u();async function ie(){try{g.value=!0;const e=await fetch("/api/game/mods",{headers:{Authorization:`Bearer ${k.token}`}});e.ok?ee.value=await e.json():y.error("åŠ è½½æ¸¸æˆåˆ—è¡¨å¤±è´¥")}catch(e){console.error("åŠ è½½modåˆ—è¡¨å¤±è´¥:",e),y.error("ç½‘ç»œé”™è¯¯")}finally{g.value=!1}}async function Oe(e){V.value=!0,h.value=e,ae.value=ee.value.find(s=>s.game_id===e),await Me()}async function Me(){try{g.value=!0,T.value="æ­£åœ¨åˆå§‹åŒ–æ¸¸æˆ...";const e=await fetch("/api/game/init",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k.token}`},body:JSON.stringify({mod_id:h.value})});if(e.ok){T.value="æ­£åœ¨åŠ è½½æ¸¸æˆæ•°æ®...";const s=await e.json();n.value=s.state||s,T.value="æ­£åœ¨å»ºç«‹å®æ—¶è¿æ¥...",ne()}else{const s=await e.text();console.error("[GameView] åˆå§‹åŒ–å¤±è´¥:",s),y.error("åˆå§‹åŒ–æ¸¸æˆå¤±è´¥: "+s)}}catch(e){console.error("åˆå§‹åŒ–æ¸¸æˆå¤±è´¥:",e),y.error("ç½‘ç»œé”™è¯¯")}finally{g.value=!1}}function ne(){const s=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/game/ws?mod_id=${h.value}&token=${k.token}`;d=new WebSocket(s),d.onopen=()=>{w.value=!0,g.value=!1,y.success("è¿æ¥æˆåŠŸ")},d.onmessage=a=>{try{const i=JSON.parse(a.data);xe(i)}catch(i){console.error("[GameView] è§£æWebSocketæ¶ˆæ¯å¤±è´¥:",i)}},d.onerror=a=>{console.error("[GameView] âŒ WebSocketé”™è¯¯:",a),w.value=!1,y.error("è¿æ¥é”™è¯¯")},d.onclose=a=>{w.value=!1,V.value&&h.value&&k.token&&setTimeout(()=>{ne()},3e3)}}const N=u(""),J=u(!1),C=u(null),W=u(""),K=u(!1);function xe(e){var s;switch(g.value=!1,e.type){case"narrative_chunk":J.value||(J.value=!0,N.value="",n.value&&n.value.display_history&&(n.value.display_history=[...n.value.display_history,N.value])),N.value+=e.data.content;let a=N.value;const i=a.indexOf("```json");i>=0&&(a=a.substring(0,i).trim());const l=a.indexOf("```");l>=0&&(a=a.substring(0,l).trim());const c=a.match(/ã€åˆ¤å®šç»“æœï¼š(æˆåŠŸ|å¤±è´¥)ã€‘/);if(c&&!C.value){C.value=a,le(c[1]==="æˆåŠŸ");return}if(n.value&&n.value.display_history){const R=n.value.display_history.length-1;n.value.display_history=[...n.value.display_history.slice(0,R),a]}M(()=>O());break;case"full_state":J.value=!1,K.value=!1,b.value=!1;const Q=((s=n.value)==null?void 0:s.display_history)||[];n.value={...e.data,display_history:Q},N.value="",W.value="",C.value=null,M(()=>O());break;case"roll_event":b.value=!0,le(e.data.success,e.data);break;case"roll_result":n.value&&n.value.display_history&&(n.value.display_history=[...n.value.display_history,e.data.content],M(()=>O()));break;case"second_stage_narrative":K.value||(K.value=!0,W.value="",n.value&&n.value.display_history&&(n.value.display_history=[...n.value.display_history,W.value])),W.value+=e.data.content;let m=W.value;const I=m.indexOf("```json");I>=0&&(m=m.substring(0,I).trim());const L=m.indexOf("```");if(L>=0&&(m=m.substring(0,L).trim()),n.value&&n.value.display_history){const R=n.value.display_history.length-1;n.value.display_history=[...n.value.display_history.slice(0,R),m],M(()=>O())}break;case"error":J.value=!1,K.value=!1,N.value="",W.value="",C.value=null,y.error(e.detail||"å‘ç”Ÿé”™è¯¯");break}}function le(e,s){se.value=!0,s?_.value={type:s.type||"å¤©é“è£å†³",target:s.target,description:s.description||"åˆ¤å®šä¸­...",result:s.result,success:e,outcome:s.outcome}:_.value={description:"åˆ¤å®šä¸­...",success:e},setTimeout(()=>{_.value&&(_.value.description=(s==null?void 0:s.description)||(e?"åˆ¤å®šæˆåŠŸï¼":"åˆ¤å®šå¤±è´¥ï¼"))},1500),setTimeout(()=>{if(se.value=!1,_.value=null,C.value&&n.value){const a=n.value.display_history.length-1;n.value.display_history=[...n.value.display_history.slice(0,a),C.value],M(()=>O())}C.value=null},3e3)}async function oe(){if(!d||d.readyState!==WebSocket.OPEN){console.error("[GameView] WebSocketæœªè¿æ¥"),y.error("è¿æ¥æœªå°±ç»ªï¼Œè¯·ç¨å€™é‡è¯•");return}n.value&&n.value.state&&(n.value.state.is_processing=!0),n.value&&n.value.display_history&&(n.value.display_history=[...n.value.display_history,"> å¼€å§‹è¯•ç‚¼"],M(()=>O())),g.value=!0,T.value="æ­£åœ¨å¼€å¯è¯•ç‚¼...",d.send(JSON.stringify({action:"start_trial"}))}function U(){if($.value.trim()&&d&&d.readyState===WebSocket.OPEN){const e=$.value.trim();n.value&&n.value.state&&(n.value.state.is_processing=!0),n.value&&n.value.display_history&&(n.value.display_history=[...n.value.display_history,`> ${e}`],M(()=>O())),d.send(JSON.stringify({action:e})),$.value=""}}async function q(){if(h.value){G.value=!0;try{const e=await fetch("/api/game/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k.token}`},body:JSON.stringify({mod_id:h.value})});if(e.ok)y.success("å­˜æ¡£æˆåŠŸ");else{const s=await e.text();console.error("[GameView] å­˜æ¡£å¤±è´¥:",s),y.error("å­˜æ¡£å¤±è´¥")}}catch(e){console.error("[GameView] å­˜æ¡£å¼‚å¸¸:",e),y.error("å­˜æ¡£å¼‚å¸¸")}finally{G.value=!1}}}function re(){confirm(`âš ï¸ ç¡®å®šè¦é‡å¯æœºç¼˜å—ï¼Ÿ

è¿™å°†ä¼šï¼š
â€¢ æ¸…ç©ºå½“å‰æ¸¸æˆçš„å­˜æ¡£æ•°æ®
â€¢ é‡ç½®æœºç¼˜æ¬¡æ•°ä¸º10æ¬¡
â€¢ æ— æ³•æ¢å¤å·²åˆ é™¤çš„æ•°æ®

ç¡®è®¤ç»§ç»­ï¼Ÿ`)&&Te()}async function Te(){var e;try{g.value=!0,T.value="æ­£åœ¨é‡å¯æœºç¼˜...";const s=await fetch("/api/game/restart-opportunities",{method:"POST",headers:{Authorization:`Bearer ${k.token}`,"Content-Type":"application/json"},body:JSON.stringify({mod_id:h.value})});if(s.ok){const a=await s.json();V.value=!1,d&&(d.close(),d=null),w.value=!1,h.value="",n.value=null,await ie(),y.success(`æœºç¼˜å·²é‡å¯ï¼åˆ é™¤äº† ${a.deleted_saves} æ¡å­˜æ¡£`)}else{const a=await s.text();console.error("[GameView] é‡å¯æœºç¼˜å¤±è´¥ - çŠ¶æ€ç :",s.status),console.error("[GameView] é‡å¯æœºç¼˜å¤±è´¥ - å“åº”:",a),console.error("[GameView] é‡å¯æœºç¼˜å¤±è´¥ - tokené•¿åº¦:",((e=k.token)==null?void 0:e.length)||0),s.status===401?(y.error("è®¤è¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•"),k.logout(),te.push("/login")):y.error("é‡å¯æœºç¼˜å¤±è´¥: "+a)}}catch(s){console.error("é‡å¯æœºç¼˜å¤±è´¥:",s),y.error("ç½‘ç»œé”™è¯¯")}finally{g.value=!1}}function Ge(){x.value=!x.value}function ce(){x.value=!1}function Ve(){P.value=!P.value}function B(){P.value=!1}function Ne(){q(),B()}function We(){re(),B()}function Re(){de(),B()}function Be(){ue(),B()}async function de(){V.value=!1,h.value&&await q(),d&&(d.close(),d=null),w.value=!1,h.value="",n.value=null}async function ue(){V.value=!1,h.value&&await q(),d&&(d.close(),d=null),k.logout(),te.push("/login")}function Ee(e){try{let s=e.replace(/\\n/g,`
`);return qe.parse(s,{breaks:!0,gfm:!0})}catch{return e.replace(/\\n/g,"<br>").replace(/\n/g,"<br>")}}function Ie(e){return e.startsWith("> ")?"user-message":e.startsWith("ã€åˆ¤å®šç»“æœï¼š")?"roll-result-message":e.startsWith("ã€")?"system-message":"narrative-message"}function E(e){const s=[{pattern:/^(å§“å|åç§°|è§’è‰²)$/i,icon:"ğŸ§™â€â™‚ï¸"},{pattern:/^(ä¿®ä¸º|ç»éªŒ|exp)$/i,icon:"âš¡"},{pattern:/^(å¢ƒç•Œ|ç­‰çº§|level|é˜¶ä½)$/i,icon:"ğŸ”ï¸"},{pattern:/^(ç”Ÿå‘½|è¡€é‡|hp|health)$/i,icon:"â¤ï¸"},{pattern:/^(å¯¿å…ƒ|å¯¿å‘½|å¹´é¾„|age)$/i,icon:"â³"},{pattern:/^(çµçŸ³|é‡‘å¸|è´§å¸|money|gold)$/i,icon:"ğŸ’"},{pattern:/^(ä½ç½®|åœ°ç‚¹|location)$/i,icon:"ğŸ“"},{pattern:/^(å‡ºèº«|èƒŒæ™¯|origin)$/i,icon:"ğŸ¡"},{pattern:/^(å¤©èµ‹|æ‰èƒ½|talent)$/i,icon:"â­"},{pattern:/^(çµæ ¹|èµ„è´¨|æ ¹éª¨)$/i,icon:"ğŸŒ¿"},{pattern:/^(å±æ€§|çŠ¶æ€|stats)$/i,icon:"ğŸ“Š"},{pattern:/^(åŠŸæ³•|æŠ€èƒ½|skill)$/i,icon:"ğŸ“š"},{pattern:/^(ç‰©å“|é“å…·|èƒŒåŒ…|inventory)$/i,icon:"ğŸ’"},{pattern:/^(çŠ¶æ€|æ•ˆæœ|buff|debuff)$/i,icon:"ğŸ’«"},{pattern:/^(äº‹ä»¶|å†å²|æ•…äº‹|history)$/i,icon:"ğŸ“œ"},{pattern:/^(ç›®æ ‡|ä»»åŠ¡|quest)$/i,icon:"ğŸ¯"},{pattern:/^(å…³ç³»|äººé™…|ç¤¾äº¤)$/i,icon:"ğŸ‘¥"},{pattern:/^(è¯å›­|å†œåœº|ç§æ¤)$/i,icon:"ğŸŒ±"},{pattern:/^(æ‚Ÿæ€§|æ™ºåŠ›|intelligence)$/i,icon:"ğŸ§ "},{pattern:/^(æ°”è¿|è¿æ°”|luck)$/i,icon:"ğŸ€"},{pattern:/^(å£°æœ›|åæœ›|reputation)$/i,icon:"â­"}];for(const a of s)if(a.pattern.test(e))return`${a.icon} ${e}`;return`ğŸ“‹ ${e}`}function F(e){if(e==null)return'<span class="empty-value">æ— </span>';if(typeof e=="string")return e;if(typeof e=="number")return e.toString();if(Array.isArray(e))return e.length===0?'<span class="empty-value">æ— </span>':e.map(s=>typeof s=="string"?`<div class="array-item">â€¢ ${s}</div>`:typeof s=="object"&&s!==null?s.åç§°&&s.æ•°é‡?`<div class="item-entry">â€¢ ${s.åç§°} Ã— ${s.æ•°é‡}${s.è¯´æ˜?`<br><span class="item-desc">${s.è¯´æ˜}</span>`:""}</div>`:`<div class="array-item">â€¢ ${pe(s)}</div>`:`<div class="array-item">â€¢ ${s}</div>`).join("");if(typeof e=="object"){if(e.äººç”Ÿç›®æ ‡||e.ç«‹å³ç›®æ ‡||e.é˜¶æ®µç›®æ ‡){let s='<div class="goal-system-container">';return e.äººç”Ÿç›®æ ‡&&(s+='<div class="goal-section goal-life">',s+='<div class="goal-section-title">ğŸŒŸ äººç”Ÿç›®æ ‡</div>',s+='<div class="goal-section-content">',e.äººç”Ÿç›®æ ‡.æè¿°&&(s+=`<div class="goal-field"><span class="field-label">æè¿°ï¼š</span>${e.äººç”Ÿç›®æ ‡.æè¿°}</div>`),e.äººç”Ÿç›®æ ‡.æ ¸å¿ƒåŠ¨æœº&&(s+=`<div class="goal-field"><span class="field-label">æ ¸å¿ƒåŠ¨æœºï¼š</span>${e.äººç”Ÿç›®æ ‡.æ ¸å¿ƒåŠ¨æœº}</div>`),e.äººç”Ÿç›®æ ‡.æœ€ç»ˆæ„¿æ™¯&&(s+=`<div class="goal-field"><span class="field-label">æœ€ç»ˆæ„¿æ™¯ï¼š</span>${e.äººç”Ÿç›®æ ‡.æœ€ç»ˆæ„¿æ™¯}</div>`),e.äººç”Ÿç›®æ ‡.å®¿å‘½çº è‘›&&Array.isArray(e.äººç”Ÿç›®æ ‡.å®¿å‘½çº è‘›)&&e.äººç”Ÿç›®æ ‡.å®¿å‘½çº è‘›.length>0&&(s+=`<div class="goal-field"><span class="field-label">å®¿å‘½çº è‘›ï¼š</span><div class="field-list">${e.äººç”Ÿç›®æ ‡.å®¿å‘½çº è‘›.map(a=>`<div class="list-item">â€¢ ${a}</div>`).join("")}</div></div>`),s+="</div></div>"),e.ç«‹å³ç›®æ ‡&&(s+='<div class="goal-section goal-immediate">',s+='<div class="goal-section-title">âš¡ ç«‹å³ç›®æ ‡</div>',s+='<div class="goal-section-content">',e.ç«‹å³ç›®æ ‡.æè¿°&&(s+=`<div class="goal-field"><span class="field-label">æè¿°ï¼š</span>${e.ç«‹å³ç›®æ ‡.æè¿°}</div>`),e.ç«‹å³ç›®æ ‡.ç´§è¿«ç¨‹åº¦&&(s+=`<div class="goal-field"><span class="field-label">ç´§è¿«ç¨‹åº¦ï¼š</span><span class="urgency-badge urgency-${e.ç«‹å³ç›®æ ‡.ç´§è¿«ç¨‹åº¦}">${e.ç«‹å³ç›®æ ‡.ç´§è¿«ç¨‹åº¦}</span></div>`),e.ç«‹å³ç›®æ ‡.å®Œæˆæ¡ä»¶&&(s+=`<div class="goal-field"><span class="field-label">å®Œæˆæ¡ä»¶ï¼š</span>${e.ç«‹å³ç›®æ ‡.å®Œæˆæ¡ä»¶}</div>`),e.ç«‹å³ç›®æ ‡.å¥–åŠ±é¢„æœŸ&&(s+=`<div class="goal-field"><span class="field-label">å¥–åŠ±é¢„æœŸï¼š</span>${e.ç«‹å³ç›®æ ‡.å¥–åŠ±é¢„æœŸ}</div>`),s+="</div></div>"),e.é˜¶æ®µç›®æ ‡&&(s+='<div class="goal-section goal-stage">',s+='<div class="goal-section-title">ğŸ“ˆ é˜¶æ®µç›®æ ‡</div>',s+='<div class="goal-section-content">',e.é˜¶æ®µç›®æ ‡.æè¿°&&(s+=`<div class="goal-field"><span class="field-label">æè¿°ï¼š</span>${e.é˜¶æ®µç›®æ ‡.æè¿°}</div>`),e.é˜¶æ®µç›®æ ‡.å…³é”®èŠ‚ç‚¹&&Array.isArray(e.é˜¶æ®µç›®æ ‡.å…³é”®èŠ‚ç‚¹)&&e.é˜¶æ®µç›®æ ‡.å…³é”®èŠ‚ç‚¹.length>0&&(s+=`<div class="goal-field"><span class="field-label">å…³é”®èŠ‚ç‚¹ï¼š</span><div class="field-list">${e.é˜¶æ®µç›®æ ‡.å…³é”®èŠ‚ç‚¹.map(a=>`<div class="list-item">â€¢ ${a}</div>`).join("")}</div></div>`),e.é˜¶æ®µç›®æ ‡.éšœç¢åˆ†æ&&(s+=`<div class="goal-field"><span class="field-label">éšœç¢åˆ†æï¼š</span>${e.é˜¶æ®µç›®æ ‡.éšœç¢åˆ†æ}</div>`),e.é˜¶æ®µç›®æ ‡.è§£å†³è·¯å¾„&&(s+=`<div class="goal-field"><span class="field-label">è§£å†³è·¯å¾„ï¼š</span>${e.é˜¶æ®µç›®æ ‡.è§£å†³è·¯å¾„}</div>`),s+="</div></div>"),s+="</div>",s}return e.å§“å||e.å¢ƒç•Œ||e.ä¿®ä¸º||e.çµæ ¹?Le(e):ve(e)}return String(e)}function Le(e){let s='<div class="attributes-expanded">';const a=["å§“å","å‡ºèº«","çµæ ¹","å¢ƒç•Œ","å¯¿å…ƒ","ç”Ÿå‘½å€¼","ä¿®ä¸º","çµçŸ³","æ ¹éª¨","æ‚Ÿæ€§","æ°”è¿","åˆå§‹å¤©èµ‹","åŠŸæ³•","ç¥é€š","ç‰©å“","çŠ¶æ€æ•ˆæœ","å…³ç³»ç½‘","å£°æœ›","ç‰¹æ®Šæ ‡è®°","çµå…½","é“ä¾£","æ´åºœ","è¯å›­"];return a.forEach(i=>{e[i]!==void 0&&e[i]!==null&&e[i]!==""&&!(Array.isArray(e[i])&&e[i].length===0)&&!(typeof e[i]=="object"&&!Array.isArray(e[i])&&Object.keys(e[i]).length===0)&&(s+=`<div class="attr-sub-item">
        <div class="attr-sub-key">${E(i)}</div>
        <div class="attr-sub-value">${F(e[i])}</div>
      </div>`)}),Object.keys(e).forEach(i=>{!a.includes(i)&&e[i]!==void 0&&e[i]!==null&&e[i]!==""&&!(Array.isArray(e[i])&&e[i].length===0)&&!(typeof e[i]=="object"&&!Array.isArray(e[i])&&Object.keys(e[i]).length===0)&&(s+=`<div class="attr-sub-item">
        <div class="attr-sub-key">${E(i)}</div>
        <div class="attr-sub-value">${F(e[i])}</div>
      </div>`)}),s+="</div>",s}function ve(e,s=0){const a=Object.entries(e).filter(([l,c])=>!(c==null||c===""||Array.isArray(c)&&c.length===0||typeof c=="object"&&!Array.isArray(c)&&Object.keys(c).length===0));if(a.length===0)return'<span class="empty-value">æ— </span>';let i='<div class="object-expanded">';return a.forEach(([l,c])=>{i+='<div class="object-item">',i+=`<div class="object-key">${E(l)}</div>`,i+='<div class="object-value">',c==null?i+='<span class="empty-value">æ— </span>':typeof c=="string"||typeof c=="number"||typeof c=="boolean"?i+=String(c):Array.isArray(c)?i+=He(c,s+1):typeof c=="object"?i+=ve(c,s+1):i+=String(c),i+="</div>",i+="</div>"}),i+="</div>",i}function He(e,s=0){if(e.length===0)return'<span class="empty-value">æ— </span>';let a='<div class="array-container">';return e.forEach(i=>{a+='<div class="array-item-wrapper">',typeof i=="string"||typeof i=="number"||typeof i=="boolean"?a+=`<div class="array-item-simple">â€¢ ${i}</div>`:typeof i=="object"&&i!==null?(a+='<div class="array-item-object">',a+=pe(i),a+="</div>"):a+=`<div class="array-item-simple">â€¢ ${i}</div>`,a+="</div>"}),a+="</div>",a}function pe(e){const s=Object.entries(e);if(s.length===0)return'<span class="empty-value">æ— </span>';let a='<div class="inline-object">';return s.forEach(([i,l])=>{l==null||l===""||(a+='<div class="inline-item">',a+=`<span class="inline-key">${i}:</span> `,typeof l=="string"||typeof l=="number"||typeof l=="boolean"?a+=`<span class="inline-value">${l}</span>`:Array.isArray(l)?a+=`<span class="inline-value">[${l.length}é¡¹]</span>`:typeof l=="object"?a+='<span class="inline-value">{å¯¹è±¡}</span>':a+=`<span class="inline-value">${l}</span>`,a+="</div>")}),a+="</div>",a}function fe(){var s;if(!w.value)return"è¿æ¥ä¸­...";const e=((s=f.value)==null?void 0:s.opportunities_remaining)??10;return e<=0?"æœºç¼˜å·²å°½":e===10?"å¼€å§‹ç¬¬ä¸€æ¬¡è¯•ç‚¼":"å¼€å¯ä¸‹ä¸€æ¬¡è¯•ç‚¼"}function O(){z.value&&(z.value.scrollTop=z.value.scrollHeight)}return Je(()=>{ie()}),Ke(()=>{V.value=!1,d&&(d.close(),d=null),w.value=!1}),(e,s)=>{var a,i,l,c,Q,m,I,L,R,ye,he,_e,ge,be,me,ke;return r(),o("div",Qe,[h.value?(r(),o("div",ts,[t("header",as,[t("div",is,[t("div",ns,[t("h2",null,v((a=ae.value)==null?void 0:a.name),1),t("span",ls,v(h.value),1)]),t("div",os,[t("span",rs,[s[6]||(s[6]=$e(" å‰©ä½™æœºç¼˜: ",-1)),t("strong",null,v(((i=f.value)==null?void 0:i.opportunities_remaining)??10),1)]),t("button",{onClick:q,class:"btn-save",disabled:G.value},v(G.value?"å­˜æ¡£ä¸­...":"ğŸ’¾ æ‰‹åŠ¨å­˜æ¡£"),9,cs),t("button",{onClick:re,class:"btn-restart",title:"æ¸…ç©ºæ‰€æœ‰å­˜æ¡£ï¼Œé‡æ–°å¼€å§‹"}," ğŸ”„ é‡å¯æœºç¼˜ "),t("button",{onClick:de,class:"btn-secondary"},"åˆ‡æ¢æ¸¸æˆ"),t("button",{onClick:ue,class:"btn-danger"},"é€€å‡º")]),t("div",ds,[t("span",us,[s[7]||(s[7]=$e(" å‰©ä½™æœºç¼˜: ",-1)),t("strong",null,v(((l=f.value)==null?void 0:l.opportunities_remaining)??10),1)]),t("button",{onClick:Ge,class:D(["btn-status",{active:x.value}])}," çŠ¶æ€ ",2),t("button",{onClick:Ve,class:"btn-menu"}," âš™ï¸ ")])])]),P.value?(r(),o("div",{key:0,class:"mobile-menu-overlay",onClick:B},[t("div",{class:"mobile-menu",onClick:s[0]||(s[0]=we(()=>{},["stop"]))},[t("button",{onClick:Ne,disabled:G.value},v(G.value?"å­˜æ¡£ä¸­...":"ğŸ’¾ æ‰‹åŠ¨å­˜æ¡£"),9,vs),t("button",{onClick:We}," ğŸ”„ é‡å¯æœºç¼˜ "),t("button",{onClick:Re}," ğŸ® åˆ‡æ¢æ¸¸æˆ "),t("button",{onClick:Be}," ğŸšª é€€å‡º ")])])):A("",!0),t("div",ps,[t("aside",fs,[s[9]||(s[9]=t("div",{class:"panel-header"},[t("h3",null,"è§’è‰²çŠ¶æ€")],-1)),t("div",ys,[H.value?(r(),o("div",hs,[(r(!0),o(Y,null,Z(H.value,(p,j)=>(r(),o("div",{key:j,class:"status-item"},[t("div",_s,v(E(j)),1),t("div",{class:"status-value",innerHTML:F(p)},null,8,gs)]))),128))])):(r(),o("div",bs,[...s[8]||(s[8]=[t("p",null,"å°šæœªå¼€å§‹å†’é™©",-1)])]))])]),t("main",ms,[t("div",{class:"narrative-window",ref_key:"narrativeWindow",ref:z},[(r(!0),o(Y,null,Z(Ce.value,(p,j)=>(r(),o("div",{key:j,class:D(["narrative-block",Ie(p)]),innerHTML:Ee(p)},null,10,ks))),128))],512),t("div",$s,[!((c=f.value)!=null&&c.is_in_trial)&&!((Q=f.value)!=null&&Q.daily_success_achieved)?(r(),o("button",{key:0,onClick:oe,disabled:!w.value||S.value||b.value||(((m=f.value)==null?void 0:m.opportunities_remaining)??0)<=0,class:"btn-start"},v(fe()),9,ws)):(I=f.value)!=null&&I.is_in_trial?(r(),o("div",Ss,[Se(t("input",{"onUpdate:modelValue":s[1]||(s[1]=p=>$.value=p),type:"text",placeholder:"æ±æ¬²ä½•ä¸º...",onKeydown:Ae(U,["enter"]),disabled:S.value||b.value,class:"action-input"},null,40,js),[[je,$.value]]),t("button",{onClick:U,disabled:S.value||b.value||!$.value.trim(),class:"btn-primary"},v(S.value?"å¤„ç†ä¸­...":b.value?"åˆ¤å®šä¸­...":"è¡ŒåŠ¨"),9,As)])):(L=f.value)!=null&&L.daily_success_achieved?(r(),o("div",Cs,[...s[10]||(s[10]=[t("p",null,"ğŸ‰ ä»Šæ—¥åŠŸå¾·åœ†æ»¡ï¼æ˜æ—¥å†æ¥ã€‚",-1)])])):A("",!0)])])]),t("div",Os,[t("div",Ms,[!((R=f.value)!=null&&R.is_in_trial)&&!((ye=f.value)!=null&&ye.daily_success_achieved)?(r(),o("button",{key:0,onClick:oe,disabled:!w.value||S.value||b.value||(((he=f.value)==null?void 0:he.opportunities_remaining)??0)<=0,class:"btn-start"},v(fe()),9,xs)):(_e=f.value)!=null&&_e.is_in_trial?(r(),o("div",Ts,[Se(t("input",{"onUpdate:modelValue":s[2]||(s[2]=p=>$.value=p),type:"text",placeholder:"æ±æ¬²ä½•ä¸º...",onKeydown:Ae(U,["enter"]),disabled:S.value||b.value,class:"action-input"},null,40,Gs),[[je,$.value]]),t("button",{onClick:U,disabled:S.value||b.value||!$.value.trim(),class:"btn-primary"},v(S.value?"å¤„ç†ä¸­...":b.value?"åˆ¤å®šä¸­...":"è¡ŒåŠ¨"),9,Vs)])):(ge=f.value)!=null&&ge.daily_success_achieved?(r(),o("div",Ns,[...s[11]||(s[11]=[t("p",null,"ğŸ‰ ä»Šæ—¥åŠŸå¾·åœ†æ»¡ï¼æ˜æ—¥å†æ¥ã€‚",-1)])])):A("",!0)])]),x.value?(r(),o("div",{key:1,class:"mobile-status-overlay",onClick:ce},[t("div",{class:D(["mobile-status-panel",{show:x.value}]),onClick:s[3]||(s[3]=we(()=>{},["stop"]))},[t("div",{class:"status-panel-header"},[s[12]||(s[12]=t("h3",null,"è§’è‰²çŠ¶æ€",-1)),t("button",{onClick:ce,class:"close-btn"},"âœ•")]),t("div",Ws,[H.value?(r(),o("div",Rs,[(r(!0),o(Y,null,Z(H.value,(p,j)=>(r(),o("div",{key:j,class:"status-item"},[t("div",Bs,v(E(j)),1),t("div",{class:"status-value",innerHTML:F(p)},null,8,Es)]))),128))])):(r(),o("div",Is,[...s[13]||(s[13]=[t("p",null,"å°šæœªå¼€å§‹å†’é™©",-1)])]))])],2)])):A("",!0)])):(r(),o("div",Xe,[s[5]||(s[5]=t("div",{class:"selection-header"},[t("h1",null,"é€‰æ‹©ä½ çš„å†’é™©"),t("p",null,"åœ¨ä¸åŒçš„ä¸–ç•Œä¸­å±•å¼€ç‹¬ä¸€æ— äºŒçš„æ—…ç¨‹")],-1)),t("div",Ye,[(r(!0),o(Y,null,Z(ee.value,p=>(r(),o("div",{key:p.game_id,class:"game-card",onClick:j=>Oe(p.game_id)},[s[4]||(s[4]=t("div",{class:"game-card-icon"},"ğŸ®",-1)),t("h3",null,v(p.name),1),t("p",null,v(p.description),1),t("div",De,[t("span",es,"v"+v(p.version),1),t("span",ss,v(p.author),1)])],8,Ze))),128))])])),se.value?(r(),o("div",Ls,[t("div",Hs,[s[14]||(s[14]=t("div",{class:"dice-cup"},"ğŸ²",-1)),t("div",Ps,[t("div",zs,v(((be=_.value)==null?void 0:be.description)||"å¤©é“è£å†³"),1),(me=_.value)!=null&&me.target?(r(),o("div",Js,"ç›®æ ‡å€¼: â‰¤"+v(_.value.target),1)):A("",!0)]),((ke=_.value)==null?void 0:ke.result)!==void 0?(r(),o("div",Ks,[t("div",{class:D(["roll-outcome",`outcome-${_.value.success?"æˆåŠŸ":"å¤±è´¥"}`])},v(_.value.success?"æˆåŠŸ":"å¤±è´¥"),3),t("div",Us,v(_.value.result),1)])):A("",!0)])])):A("",!0),g.value?(r(),o("div",qs,[t("div",Fs,[s[15]||(s[15]=t("div",{class:"spinner"},null,-1)),t("div",Qs,v(T.value),1)])])):A("",!0)])}}}),st=Fe(Xs,[["__scopeId","data-v-3cae7cdc"]]);export{st as default};
